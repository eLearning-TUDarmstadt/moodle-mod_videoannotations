define(["jquery","core/ajax","core/templates","core/notification","jqueryui"],function(a,b,c,d,e){var f=function(d){h("annotationsloader"),a(".annotation").css("visibility","hidden");var e=a.Deferred(),f=b.call([{methodname:"mod_videoannotations_get_annotations",args:{id:d},fail:function(a){console.log(a),e.reject()}}]);return f[0].done(function(b){var d={numberOfAnnotations:b.length,annotations:b},f=c.render("mod_videoannotations/annotation_list",d);f.done(function(b,d){a('[data-region="annotation-list"]').replaceWith(b),c.runTemplateJS(d),e.resolve()}),f.fail(function(a){console.log("ERROR!"),console.log(a),e.reject()})}),e.promise()},g=function(c){var d=a.Deferred();return b.call([{methodname:"mod_videoannotations_delete_annotation",args:{annotationid:c},fail:function(){d.reject()},done:function(){d.resolve()}}]),d.promise()},h=function(b){var c=a("#"+b);c.css("visibility","visible")};return{createNewAnnotation:function(){a("#createannotationform").accordion({active:!1,collapsible:!0,icons:{header:"icon-arrow-right",activeHeader:"icon-arrow-down"}}),a("#newannotationbutton").on("click",function(){a(".annotation").css("visibility","hidden"),a("#createannotationform").accordion({active:!1});var c=a("#newannotation_modinstance").val();b.call([{methodname:"mod_videoannotations_create_annotation",args:{annotationinstance:c,timeposition:0,duration:10,subject:a("#newannotation_subject").val(),text:a("#newannotation_text").val(),isquestion:a("#newannotation_isquestion").is(":checked"),isanswered:!1},fail:d.exception,done:function(){a("#newannotation_subject").val(""),a("#newannotation_text").val(""),f(c)}}])})},deleteAnnotationListener:function(){var b=a("#newannotation_modinstance").val();a(".deleteAnnotationButton").on("click",function(){var c=a(this).attr("annotationid");g(c).done(function(){f(b)})})},deleteCommentListener:function(){var c=a("#newannotation_modinstance").val();a(".deletecommentbutton").on("click",function(){var e=a(this).attr("commentid");b.call([{methodname:"mod_videoannotations_delete_comment",args:{commentid:e},fail:d.exception,done:function(){f(c)}}])})},createNewCommentListener:function(){var c=a("#newannotation_modinstance").val();a(".createnewcomment").on("click",function(e){var g=a(this).attr("id").replace("newcomment_button_",""),h=a("#newcomment_text_"+g).val();b.call([{methodname:"mod_videoannotations_create_comment",args:{annotationid:g,text:h},fail:d.exception,done:function(){a("#newcomment_text_"+g).val(""),f(c)}}])})}}});